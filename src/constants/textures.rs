use crate::components::animation::*;
use crate::components::textures::*;
use crate::singleton_distribution;
use crate::util::distribution::AnyDistribution;
use crate::weighted_distribution;
use bevy::utils::HashMap;
use once_cell::sync::Lazy;
use phf::phf_map;

pub const TEXTURE_PATH: &str = "tileset/environment/full.png";

pub static WATER_DISTRIBUTION: TextureDistribution =
    TextureDistribution(singleton_distribution![0]);

pub static GRASS_DISTRIBUTION: TextureDistribution = TextureDistribution(weighted_distribution![
    u32,
    (55, 20),
    (56, 50),
    (57, 50),
    (58, 1),
    (59, 1),
    (60, 1),
    (66, 20),
    (67, 40),
    (68, 40),
    (69, 2),
    (70, 2),
    (71, 1),
    (12, 500)
]);

pub static DARKER_GRASS_DISTRIBUTION: TextureDistribution =
    TextureDistribution(weighted_distribution![
        u32,
        (55, 20),
        (56, 50),
        (57, 50),
        (58, 1),
        (59, 1),
        (60, 1),
        (66, 20),
        (67, 40),
        (68, 40),
        (69, 2),
        (70, 2),
        (71, 1),
        (12, 500)
    ]);

pub static SOIL_DISTRIBUTION: TextureDistribution = TextureDistribution(weighted_distribution![
    u32,
    (55, 20),
    (56, 50),
    (57, 50),
    (58, 1),
    (59, 1),
    (66, 20),
    (67, 40),
    (68, 40),
    (69, 2),
    (70, 2),
    (12, 500)
]);

pub static TEXTURE_RELIEF_IDS_MAP: TextureReliefIDsPHF = TextureReliefIDsPHF(phf_map! {
    0u32 => &WATER_DISTRIBUTION,
    1u32 => &SOIL_DISTRIBUTION,
    2u32 => &GRASS_DISTRIBUTION,
    3u32 => &GRASS_DISTRIBUTION,
    4u32 => &GRASS_DISTRIBUTION,
    5u32 => &DARKER_GRASS_DISTRIBUTION,
    6u32 => &DARKER_GRASS_DISTRIBUTION,
    7u32 => &DARKER_GRASS_DISTRIBUTION,
});

const WATER: u32 = 0;
const SOIL: u32 = 1;
const GRASS_HILL: u32 = 4;
const DARKER_GRASS_HILL: u32 = 5;

// Top-of-water tilesets:
//const GRASS: u32 = 2;
//const DARKER_GRASS: u32 = 3;

const TILESET_SIZE: u32 = 77;

pub const TEXTURE_ID_OFFSET_MAP: TextureIDOffsetPHF = TextureIDOffsetPHF(phf_map! {
    0u32 => TILESET_SIZE*WATER,
    1u32 => TILESET_SIZE*SOIL,
    2u32 => TILESET_SIZE*GRASS_HILL,
    3u32 => TILESET_SIZE*GRASS_HILL,
    4u32 => TILESET_SIZE*GRASS_HILL,
    5u32 => TILESET_SIZE*DARKER_GRASS_HILL,
    6u32 => TILESET_SIZE*DARKER_GRASS_HILL,
    7u32 => TILESET_SIZE*DARKER_GRASS_HILL,
});

const WATER_FPS: f32 = 1.;

// All texture animations
pub static TEXTURE_ANIMATION_MAP: Lazy<TileAnimationMap> = Lazy::new(|| {
    TileAnimationMap(HashMap::from([(
        (0, 0),
        FixedAnimation::new(0, 4, WATER_FPS),
    )]))
});

#[allow(clippy::unusual_byte_groupings)]
pub const TEXTURE_CORNER_IDS_MAP: TextureCornerIDsPHF = TextureCornerIDsPHF(
    // 000
    // 0_0 => 000_0_0_000
    // 000
    phf_map! {
        0b111_1_0_100u32 => 0,
        0b110_1_0_100u32 => 0,
        0b111_1_0_000u32 => 0,
        0b110_1_0_000u32 => 0,
        0b011_1_0_100u32 => 0,
        0b010_1_0_100u32 => 0,
        0b011_1_0_000u32 => 0,
        0b010_1_0_000u32 => 0,

        0b111_0_0_000u32 => 1,
        0b110_0_0_000u32 => 1,
        0b011_0_0_000u32 => 1,
        0b010_0_0_000u32 => 1,

        0b111_0_1_001u32 => 2,
        0b011_0_1_001u32 => 2,
        0b111_0_1_000u32 => 2,
        0b011_0_1_000u32 => 2,
        0b110_0_1_001u32 => 2,
        0b010_0_1_001u32 => 2,
        0b110_0_1_000u32 => 2,
        0b010_0_1_000u32 => 2,

        0b111_1_1_101u32 => 3,
        0b110_1_1_101u32 => 3,
        0b011_1_1_101u32 => 3,
        0b010_1_1_101u32 => 3,
        0b111_1_1_100u32 => 3,
        0b110_1_1_100u32 => 3,
        0b011_1_1_100u32 => 3,
        0b010_1_1_100u32 => 3,
        0b111_1_1_001u32 => 3,
        0b110_1_1_001u32 => 3,
        0b011_1_1_001u32 => 3,
        0b010_1_1_001u32 => 3,
        0b111_1_1_000u32 => 3,
        0b110_1_1_000u32 => 3,
        0b011_1_1_000u32 => 3,
        0b010_1_1_000u32 => 3,

        0b111_1_0_101u32 => 4,
        0b111_1_0_001u32 => 4,
        0b011_1_0_101u32 => 4,
        0b011_1_0_001u32 => 4,
        0b110_1_0_101u32 => 4,
        0b110_1_0_001u32 => 4,
        0b010_1_0_101u32 => 4,
        0b010_1_0_001u32 => 4,

        0b111_0_0_001u32 => 5,
        0b110_0_0_001u32 => 5,
        0b011_0_0_001u32 => 5,
        0b010_0_0_001u32 => 5,

        0b111_0_0_100u32 => 6,
        0b011_0_0_100u32 => 6,
        0b110_0_0_100u32 => 6,
        0b010_0_0_100u32 => 6,

        0b111_0_1_101u32 => 7,
        0b111_0_1_100u32 => 7,
        0b110_0_1_101u32 => 7,
        0b110_0_1_100u32 => 7,
        0b011_0_1_101u32 => 7,
        0b011_0_1_100u32 => 7,
        0b010_0_1_101u32 => 7,
        0b010_0_1_100u32 => 7,

        0b111_0_0_101u32 => 8,
        0b110_0_0_101u32 => 8,
        0b011_0_0_101u32 => 8,
        0b010_0_0_101u32 => 8,

        0b001_0_0_100u32 => 9,

        0b100_1_0_100u32 => 11,
        0b100_1_0_000u32 => 11,
        0b000_1_0_100u32 => 11,
        0b000_1_0_000u32 => 11,

        0b000_0_0_000u32 => 12,

        0b001_0_1_001u32 => 13,
        0b000_0_1_001u32 => 13,
        0b001_0_1_000u32 => 13,
        0b000_0_1_000u32 => 13,

        0b101_1_1_101u32 => 14,
        0b101_1_1_100u32 => 14,
        0b101_1_1_001u32 => 14,
        0b101_1_1_000u32 => 14,
        0b001_1_1_101u32 => 14,
        0b001_1_1_100u32 => 14,
        0b001_1_1_001u32 => 14,
        0b001_1_1_000u32 => 14,
        0b100_1_1_101u32 => 14,
        0b100_1_1_100u32 => 14,
        0b100_1_1_001u32 => 14,
        0b100_1_1_000u32 => 14,
        0b000_1_1_101u32 => 14,
        0b000_1_1_100u32 => 14,
        0b000_1_1_001u32 => 14,
        0b000_1_1_000u32 => 14,

        0b100_1_0_101u32 => 15,
        0b000_1_0_101u32 => 15,
        0b100_1_0_001u32 => 15,
        0b000_1_0_001u32 => 15,

        0b000_0_0_001u32 => 16,
        0b000_0_0_100u32 => 17,

        0b001_0_1_101u32 => 18,
        0b001_0_1_100u32 => 18,
        0b000_0_1_101u32 => 18,
        0b000_0_1_100u32 => 18,

        0b000_0_0_101u32 => 19,
        0b100_0_0_001u32 => 20,

        0b100_1_0_111u32 => 22,
        0b000_1_0_111u32 => 22,
        0b100_1_0_110u32 => 22,
        0b000_1_0_110u32 => 22,
        0b100_1_0_011u32 => 22,
        0b000_1_0_011u32 => 22,
        0b100_1_0_010u32 => 22,
        0b000_1_0_010u32 => 22,

        0b000_0_0_111u32 => 23,
        0b000_0_0_110u32 => 23,
        0b000_0_0_011u32 => 23,
        0b000_0_0_010u32 => 23,

        0b001_0_1_111u32 => 24,
        0b000_0_1_111u32 => 24,
        0b001_0_1_011u32 => 24,
        0b000_0_1_011u32 => 24,
        0b001_0_1_110u32 => 24,
        0b000_0_1_110u32 => 24,
        0b001_0_1_010u32 => 24,
        0b000_0_1_010u32 => 24,

        0b101_1_1_111u32 => 25,
        0b100_1_1_111u32 => 25,
        0b001_1_1_111u32 => 25,
        0b000_1_1_111u32 => 25,
        0b101_1_1_110u32 => 25,
        0b100_1_1_110u32 => 25,
        0b001_1_1_110u32 => 25,
        0b000_1_1_110u32 => 25,
        0b101_1_1_011u32 => 25,
        0b100_1_1_011u32 => 25,
        0b001_1_1_011u32 => 25,
        0b000_1_1_011u32 => 25,
        0b101_1_1_010u32 => 25,
        0b100_1_1_010u32 => 25,
        0b001_1_1_010u32 => 25,
        0b000_1_1_010u32 => 25,

        0b101_1_0_100u32 => 26,
        0b101_1_0_000u32 => 26,
        0b001_1_0_100u32 => 26,
        0b001_1_0_000u32 => 26,

        0b001_0_0_000u32 => 27,
        0b100_0_0_000u32 => 28,

        0b101_0_1_001u32 => 29,
        0b101_0_1_000u32 => 29,
        0b100_0_1_001u32 => 29,
        0b100_0_1_000u32 => 29,

        0b101_0_0_000u32 => 30,
        0b101_0_0_100u32 => 31,
        0b101_0_0_001u32 => 32,

        0b111_1_0_111u32 => 33,
        0b011_1_0_111u32 => 33,
        0b111_1_0_011u32 => 33,
        0b011_1_0_011u32 => 33,
        0b111_1_0_110u32 => 33,
        0b011_1_0_110u32 => 33,
        0b111_1_0_010u32 => 33,
        0b011_1_0_010u32 => 33,
        0b110_1_0_111u32 => 33,
        0b010_1_0_111u32 => 33,
        0b110_1_0_011u32 => 33,
        0b010_1_0_011u32 => 33,
        0b110_1_0_110u32 => 33,
        0b010_1_0_110u32 => 33,
        0b110_1_0_010u32 => 33,
        0b010_1_0_010u32 => 33,

        0b111_0_0_111u32 => 34,
        0b111_0_0_110u32 => 34,
        0b111_0_0_011u32 => 34,
        0b111_0_0_010u32 => 34,
        0b110_0_0_111u32 => 34,
        0b110_0_0_110u32 => 34,
        0b110_0_0_011u32 => 34,
        0b110_0_0_010u32 => 34,
        0b011_0_0_111u32 => 34,
        0b011_0_0_110u32 => 34,
        0b011_0_0_011u32 => 34,
        0b011_0_0_010u32 => 34,
        0b010_0_0_111u32 => 34,
        0b010_0_0_110u32 => 34,
        0b010_0_0_011u32 => 34,
        0b010_0_0_010u32 => 34,

        0b111_0_1_111u32 => 35,
        0b011_0_1_111u32 => 35,
        0b111_0_1_011u32 => 35,
        0b011_0_1_011u32 => 35,
        0b110_0_1_111u32 => 35,
        0b010_0_1_111u32 => 35,
        0b110_0_1_011u32 => 35,
        0b010_0_1_011u32 => 35,
        0b111_0_1_110u32 => 35,
        0b011_0_1_110u32 => 35,
        0b111_0_1_010u32 => 35,
        0b011_0_1_010u32 => 35,
        0b110_0_1_110u32 => 35,
        0b010_0_1_110u32 => 35,
        0b110_0_1_010u32 => 35,
        0b010_0_1_010u32 => 35,

        0b111_1_1_111u32 => 36,
        0b110_1_1_111u32 => 36,
        0b011_1_1_111u32 => 36,
        0b010_1_1_111u32 => 36,
        0b111_1_1_110u32 => 36,
        0b110_1_1_110u32 => 36,
        0b011_1_1_110u32 => 36,
        0b010_1_1_110u32 => 36,
        0b111_1_1_011u32 => 36,
        0b110_1_1_011u32 => 36,
        0b011_1_1_011u32 => 36,
        0b010_1_1_011u32 => 36,
        0b111_1_1_010u32 => 36,
        0b110_1_1_010u32 => 36,
        0b011_1_1_010u32 => 36,
        0b010_1_1_010u32 => 36,

        0b101_1_0_111u32 => 37,
        0b001_1_0_111u32 => 37,
        0b101_1_0_011u32 => 37,
        0b001_1_0_011u32 => 37,
        0b101_1_0_110u32 => 37,
        0b001_1_0_110u32 => 37,
        0b101_1_0_010u32 => 37,
        0b001_1_0_010u32 => 37,


        0b001_0_0_111u32 => 38,
        0b001_0_0_110u32 => 38,
        0b001_0_0_011u32 => 38,
        0b001_0_0_010u32 => 38,

        0b100_0_0_111u32 => 39,
        0b100_0_0_110u32 => 39,
        0b100_0_0_011u32 => 39,
        0b100_0_0_010u32 => 39,

        0b101_0_1_111u32 => 40,
        0b100_0_1_111u32 => 40,
        0b101_0_1_110u32 => 40,
        0b100_0_1_110u32 => 40,
        0b101_0_1_011u32 => 40,
        0b100_0_1_011u32 => 40,
        0b101_0_1_010u32 => 40,
        0b100_0_1_010u32 => 40,

        0b101_0_0_111u32 => 41,
        0b101_0_0_011u32 => 41,
        0b101_0_0_110u32 => 41,
        0b101_0_0_010u32 => 41,

        0b100_0_0_101u32 => 42,
        0b001_0_0_101u32 => 43,

        0b101_1_0_101u32 => 48,
        0b001_1_0_101u32 => 48,
        0b101_1_0_001u32 => 48,
        0b001_1_0_001u32 => 48,

        0b001_0_0_001u32 => 49,
        0b100_0_0_100u32 => 50,

        0b101_0_1_101u32 => 51,
        0b100_0_1_101u32 => 51,
        0b101_0_1_100u32 => 51,
        0b100_0_1_100u32 => 51,

        0b101_0_0_101u32 => 52,
    },
);
